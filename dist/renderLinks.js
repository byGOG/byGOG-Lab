export async function fetchLinks(){const e=await fetch("links.json");if(!e.ok)throw new Error("links.json yüklenemedi");return e.json()}function createLinkItem(e){const t=document.createElement("li"),n=document.createElement("a");if(n.href=e.url,n.target="_blank",e.recommended){const e=document.createElement("span");e.className="star",e.title="Önerilen",e.setAttribute("aria-label","Önerilen"),e.textContent="★",n.appendChild(e)}let o;if(e.icon){o=document.createElement("span"),o.className="icon-wrapper";const t=document.createElement("img");t.loading="lazy",t.src=e.icon,e.alt&&(t.alt=e.alt),t.className="site-icon",o.appendChild(t),n.appendChild(o)}const a=document.createElement("span");if(a.className="link-text",a.textContent=e.name,t.dataset.nameOriginal=e.name||"",n.appendChild(a),e.description){const t=document.createElement("span");if(t.className="custom-tooltip",e.icon){const n=document.createElement("img");n.loading="lazy",n.src=e.icon,e.alt&&(n.alt=e.alt),t.appendChild(n)}t.appendChild(document.createTextNode(e.description)),n.appendChild(t)}try{const n=[];e.name&&n.push(e.name),e.description&&n.push(e.description),Array.isArray(e.tags)&&e.tags.length&&n.push(e.tags.join(" ")),t.dataset.search=n.join(" ").toLowerCase(),e.description&&(t.dataset.descOriginal=e.description)}catch{}return t.appendChild(n),t}function renderCategories(e,t){const n=document.createDocumentFragment();e.categories.forEach(e=>{const t=document.createElement("div");t.className="category-card";const o=document.createElement("h2");if(o.textContent=e.title,t.appendChild(o),e.subcategories){const n=document.createElement("div");n.className="sub-category-container",e.subcategories.forEach(e=>{const t=document.createElement("div");t.className="sub-category";const o=document.createElement("h3");o.textContent=e.title,t.appendChild(o);const a=document.createElement("ul"),r=[...e.links].sort((e,t)=>{const n=e.recommended?1:0,o=t.recommended?1:0;return n!==o?o-n:String(e.name||"").localeCompare(String(t.name||""),"tr")});let c=!1,l=!1;const s=r.some(e=>!!e.recommended),i=r.some(e=>!e.recommended);r.forEach(e=>{if(s&&i&&e.recommended&&!c){const e=document.createElement("li");e.className="group-label",e.setAttribute("role","presentation"),e.textContent="Önerilenler",a.appendChild(e),c=!0}if(s&&i&&!e.recommended&&!l){const e=document.createElement("li");e.className="group-label",e.setAttribute("role","presentation"),e.textContent="Diğerleri",a.appendChild(e),l=!0}a.appendChild(createLinkItem(e))}),t.appendChild(a),n.appendChild(t)}),t.appendChild(n)}else if(e.links){const n=document.createElement("ul"),o=[...e.links].sort((e,t)=>{const n=e.recommended?1:0,o=t.recommended?1:0;return n!==o?o-n:String(e.name||"").localeCompare(String(t.name||""),"tr")});let a=!1,r=!1;const c=o.some(e=>!!e.recommended),l=o.some(e=>!e.recommended);o.forEach(e=>{if(c&&l&&e.recommended&&!a){const e=document.createElement("li");e.className="group-label",e.setAttribute("role","presentation"),e.textContent="Önerilenler",n.appendChild(e),a=!0}if(c&&l&&!e.recommended&&!r){const e=document.createElement("li");e.className="group-label",e.setAttribute("role","presentation"),e.textContent="Diğerleri",n.appendChild(e),r=!0}n.appendChild(createLinkItem(e))}),t.appendChild(n)}n.appendChild(t)}),t.appendChild(n)}function setupSearch(){const e=document.getElementById("search-input"),t=document.getElementById("search-status"),n=Array.from(document.querySelectorAll(".category-card li")),o=n.map(e=>(e.dataset.search||e.textContent).toLowerCase());let a;function r(){const a=e.value.toLowerCase().trim();let r=0;const c=a?new RegExp(a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"):null;n.forEach((e,t)=>{const n=o[t].includes(a);if(e.style.display=n?"":"none",n){r++;const t=e.querySelector(".link-text"),n=e.dataset.nameOriginal||(t?t.textContent:"");t&&(c&&a?t.innerHTML=n.replace(c,e=>`<mark>${e}</mark>`):t.textContent=n);const o=e.querySelector(".custom-tooltip");if(o){const t=o.querySelector("img"),n=t?t.outerHTML+" ":"",r=e.dataset.descOriginal||"";c&&a&&r?o.innerHTML=n+r.replace(c,e=>`<mark>${e}</mark>`):r&&(o.innerHTML=n+r)}}else{const t=e.querySelector(".link-text");t&&(t.textContent=e.dataset.nameOriginal||t.textContent);const n=e.querySelector(".custom-tooltip");if(n){const t=n.querySelector("img"),o=t?t.outerHTML+" ":"",a=e.dataset.descOriginal||"";a&&(n.innerHTML=o+a)}}}),document.querySelectorAll(".category-card").forEach(e=>{const t=e.querySelectorAll(".sub-category");if(t.length){let n=!1;t.forEach(e=>{const t=e.querySelectorAll('li:not([style*="display: none"])').length>0;e.style.display=t?"":"none",t&&(n=!0)}),e.style.display=n?"":"none"}else{const t=e.querySelectorAll('li:not([style*="display: none"])');e.style.display=t.length>0?"":"none"}}),t.textContent=a?`${r} sonuç bulundu`:""}e.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(r,300)}),document.addEventListener("keydown",t=>{if(!("/"!==t.key||t.ctrlKey||t.metaKey||t.altKey||t.shiftKey)){const n=t.target,o=n&&n.tagName?n.tagName.toUpperCase():"";n&&n.isContentEditable||"INPUT"===o||"TEXTAREA"===o||"SELECT"===o||(t.preventDefault(),e.focus(),e.select())}}),e.addEventListener("keydown",t=>{"Escape"===t.key&&(e.value&&(e.value="",r()),t.stopPropagation())})}function setupThemeToggle(){const e=document.getElementById("theme-toggle"),t=document.body,n=window.matchMedia("(prefers-color-scheme: dark)");function o(n){const o=!!n;o?(t.classList.add("koyu"),e.textContent="☀️",e.setAttribute("aria-label","Aydınlık temaya geç")):(t.classList.remove("koyu"),e.textContent="🌙",e.setAttribute("aria-label","Koyu temaya geç")),e.setAttribute("aria-pressed",String(o))}e.addEventListener("click",()=>{const e=!t.classList.contains("koyu");o(e),localStorage.setItem("theme",e?"koyu":"aydinlik")});let a=localStorage.getItem("theme");a||(a=n.matches?"koyu":"aydinlik"),o("koyu"===a),n.addEventListener("change",e=>{localStorage.getItem("theme")||o(e.matches)})}document.addEventListener("DOMContentLoaded",async()=>{setupThemeToggle();const e=document.getElementById("links-container");try{renderCategories(await fetchLinks(),e)}catch(t){e.textContent="Bağlantılar yüklenemedi.",console.error(t)}setupSearch(),"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("sw.js").then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)},e=>{console.log("ServiceWorker registration failed: ",e)})})});
