export async function fetchLinks(){const e=await fetch("links.json");if(!e.ok)throw new Error("links.json yüklenemedi");return e.json()}function createLinkItem(e){const t=document.createElement("li"),n=document.createElement("a");if(n.href=e.url,n.target="_blank",e.recommended){const e=document.createElement("span");e.className="star",e.title="Önerilen",e.textContent="★",n.appendChild(e)}let s;if(e.icon){s=document.createElement("span"),s.className="icon-wrapper";const t=document.createElement("img");t.loading="lazy",t.src=e.icon,e.alt&&(t.alt=e.alt),t.className="site-icon",s.appendChild(t),n.appendChild(s)}const o=document.createElement("span");if(o.className="link-text",o.textContent=e.name,n.appendChild(o),e.description){const t=document.createElement("span");if(t.className="custom-tooltip",e.icon){const n=document.createElement("img");n.loading="lazy",n.src=e.icon,e.alt&&(n.alt=e.alt),t.appendChild(n)}t.appendChild(document.createTextNode(e.description)),n.appendChild(t)}return t.appendChild(n),t}function renderCategories(e,t){const n=document.createDocumentFragment();e.categories.forEach(e=>{const t=document.createElement("div");t.className="category-card";const s=document.createElement("h2");if(s.textContent=e.title,t.appendChild(s),e.subcategories){const n=document.createElement("div");n.className="sub-category-container",e.subcategories.forEach(e=>{const t=document.createElement("div");t.className="sub-category";const s=document.createElement("h3");s.textContent=e.title,t.appendChild(s);const o=document.createElement("ul");e.links.forEach(e=>o.appendChild(createLinkItem(e))),t.appendChild(o),n.appendChild(t)}),t.appendChild(n)}else if(e.links){const n=document.createElement("ul");e.links.forEach(e=>n.appendChild(createLinkItem(e))),t.appendChild(n)}n.appendChild(t)}),t.appendChild(n)}function setupSearch(){const e=document.getElementById("search-input"),t=document.getElementById("search-status"),n=document.querySelector(".search-clear"),s=document.getElementById("search-suggestions"),o=Array.from(document.querySelectorAll(".category-card li"));let a,c=[],l=-1;function i(){c=[],o.forEach((e,t)=>{const n=e.querySelector("a"),s=n.textContent.toLowerCase(),o=e.closest(".category-card")?.querySelector("h2")?.textContent||"",a=e.closest(".sub-category")?.querySelector("h3")?.textContent||"",l=n.querySelector(".custom-tooltip")?.textContent||"";c.push({element:e,text:s,category:o.toLowerCase(),subcategory:a.toLowerCase(),description:l.toLowerCase(),originalText:n.textContent,categoryText:o,subcategoryText:a})})}function r(){const n=e.value.toLowerCase().trim();if(!n)return o.forEach(e=>e.style.display=""),document.querySelectorAll(".category-card").forEach(e=>e.style.display=""),document.querySelectorAll(".sub-category").forEach(e=>e.style.display=""),t.innerHTML="",void s.classList.remove("visible");let a=0;const l=[];c.forEach(e=>{e.text.includes(n)||e.category.includes(n)||e.subcategory.includes(n)||e.description.includes(n)?(e.element.style.display="",l.push(e),a++):e.element.style.display="none"}),document.querySelectorAll(".category-card").forEach(e=>{const t=e.querySelectorAll(".sub-category");if(t.length){let n=!1;t.forEach(e=>{const t=e.querySelectorAll('li:not([style*="display: none"])').length>0;e.style.display=t?"":"none",t&&(n=!0)}),e.style.display=n?"":"none"}else{const t=e.querySelectorAll('li:not([style*="display: none"])');e.style.display=t.length>0?"":"none"}}),n?(t.innerHTML=`<span class="search-results-count">${a} sonuç bulundu</span>`,t.setAttribute("aria-live","polite"),function(t){if(0===t.length)return void s.classList.remove("visible");const n=t.slice(0,8);s.innerHTML="",n.forEach(t=>{const n=document.createElement("div");n.className="suggestion-item";const o=t.element.querySelector(".site-icon"),a=o?`<img src="${o.src}" alt="" class="suggestion-icon">`:'<div class="suggestion-icon">📱</div>';n.innerHTML=`\n        ${a}\n        <div class="suggestion-text">${t.originalText}</div>\n        <div class="suggestion-category">${t.categoryText}${t.subcategoryText?` > ${t.subcategoryText}`:""}</div>\n      `,n.addEventListener("click",()=>{t.element.scrollIntoView({behavior:"smooth",block:"center"}),t.element.style.animation="searchResultPulse 1s ease-out",setTimeout(()=>{t.element.style.animation=""},1e3),e.value="",r(),s.classList.remove("visible"),e.focus()}),s.appendChild(n)}),s.classList.add("visible")}(l)):(t.textContent="",t.setAttribute("aria-live","off"),s.classList.remove("visible"))}function d(e){e.forEach((e,t)=>{e.classList.toggle("selected",t===l)})}e.addEventListener("input",()=>{clearTimeout(a),a=setTimeout(r,300),n.classList.toggle("visible",e.value.length>0)}),e.addEventListener("keydown",function(t){const n=s.querySelectorAll(".suggestion-item");if(s.classList.contains("visible")&&0!==n.length)switch(t.key){case"ArrowDown":t.preventDefault(),l=Math.min(l+1,n.length-1),d(n);break;case"ArrowUp":t.preventDefault(),l=Math.max(l-1,-1),d(n);break;case"Enter":t.preventDefault(),l>=0&&n[l]&&n[l].click();break;case"Escape":s.classList.remove("visible"),e.blur()}}),n.addEventListener("click",function(){e.value="",e.focus(),r()}),document.addEventListener("click",t=>{e.contains(t.target)||s.contains(t.target)||s.classList.remove("visible")}),i();new MutationObserver(()=>{i()}).observe(document.getElementById("links-container"),{childList:!0,subtree:!0})}function setupThemeToggle(){const e=document.getElementById("theme-toggle"),t=document.body,n=window.matchMedia("(prefers-color-scheme: dark)");function s(n){n?(t.classList.add("koyu"),e.textContent="☀️",e.setAttribute("aria-label","Açık temaya geç"),e.title="Açık temaya geç"):(t.classList.remove("koyu"),e.textContent="🌙",e.setAttribute("aria-label","Koyu temaya geç"),e.title="Koyu temaya geç"),t.style.transition="all 0.5s cubic-bezier(0.4, 0, 0.2, 1)",setTimeout(()=>{t.style.transition=""},500)}function o(){const n=!t.classList.contains("koyu");s(n),localStorage.setItem("theme",n?"koyu":"aydinlik"),e.style.transform="scale(0.95)",setTimeout(()=>{e.style.transform=""},150)}e.addEventListener("click",o),e.addEventListener("keydown",e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o())});let a=localStorage.getItem("theme");a||(a=n.matches?"koyu":"aydinlik"),s("koyu"===a),n.addEventListener("change",e=>{localStorage.getItem("theme")||s(e.matches)}),window.addEventListener("storage",e=>{"theme"===e.key&&s("koyu"===e.newValue)})}function setupMouseTracking(){document.querySelectorAll("a").forEach(e=>{e.addEventListener("mousemove",t=>{const n=e.getBoundingClientRect(),s=(t.clientX-n.left)/n.width*100,o=(t.clientY-n.top)/n.height*100;e.style.setProperty("--mouse-x",`${s}%`),e.style.setProperty("--mouse-y",`${o}%`)})})}function setupAnimations(){const e=document.querySelectorAll("li");e.forEach((e,t)=>{e.style.animationDelay=.1+.05*t+"s",e.style.animation="fadeInUp 0.5s ease-out forwards",e.style.opacity="0"});const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.style.opacity="1",e.target.style.animation="fadeInUp 0.5s ease-out forwards")})},{threshold:.1,rootMargin:"0px 0px -50px 0px"});e.forEach(e=>t.observe(e))}document.addEventListener("DOMContentLoaded",async()=>{setupThemeToggle();const e=document.getElementById("links-container");try{renderCategories(await fetchLinks(),e)}catch(t){e.textContent="Bağlantılar yüklenemedi. Lütfen sayfayı yenileyin.",console.error("Bağlantılar yüklenirken hata:",t)}setupSearch(),setupMouseTracking(),setupAnimations()});
